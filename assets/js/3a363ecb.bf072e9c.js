"use strict";(self.webpackChunkblogsaurus=self.webpackChunkblogsaurus||[]).push([[80731],{3905:(e,n,a)=>{a.d(n,{Zo:()=>m,kt:()=>k});var t=a(67294);function l(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function o(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),a.push.apply(a,t)}return a}function r(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?o(Object(a),!0).forEach((function(n){l(e,n,a[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))}))}return e}function i(e,n){if(null==e)return{};var a,t,l=function(e,n){if(null==e)return{};var a,t,l={},o=Object.keys(e);for(t=0;t<o.length;t++)a=o[t],n.indexOf(a)>=0||(l[a]=e[a]);return l}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)a=o[t],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(l[a]=e[a])}return l}var p=t.createContext({}),s=function(e){var n=t.useContext(p),a=n;return e&&(a="function"==typeof e?e(n):r(r({},n),e)),a},m=function(e){var n=s(e.components);return t.createElement(p.Provider,{value:n},e.children)},c="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},d=t.forwardRef((function(e,n){var a=e.components,l=e.mdxType,o=e.originalType,p=e.parentName,m=i(e,["components","mdxType","originalType","parentName"]),c=s(a),d=l,k=c["".concat(p,".").concat(d)]||c[d]||u[d]||o;return a?t.createElement(k,r(r({ref:n},m),{},{components:a})):t.createElement(k,r({ref:n},m))}));function k(e,n){var a=arguments,l=n&&n.mdxType;if("string"==typeof e||l){var o=a.length,r=new Array(o);r[0]=d;var i={};for(var p in n)hasOwnProperty.call(n,p)&&(i[p]=n[p]);i.originalType=e,i[c]="string"==typeof e?e:l,r[1]=i;for(var s=2;s<o;s++)r[s]=a[s];return t.createElement.apply(null,r)}return t.createElement.apply(null,a)}d.displayName="MDXCreateElement"},96126:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>p,contentTitle:()=>r,default:()=>u,frontMatter:()=>o,metadata:()=>i,toc:()=>s});var t=a(87462),l=(a(67294),a(3905));const o={sidebar_position:18},r="[TTA] grafana \uc0ac\uc6a9",i={unversionedId:"dev-ops/dev-ops18",id:"dev-ops/dev-ops18",title:"[TTA] grafana \uc0ac\uc6a9",description:"---",source:"@site/docs/dev-ops/dev-ops18.md",sourceDirName:"dev-ops",slug:"/dev-ops/dev-ops18",permalink:"/docs/dev-ops/dev-ops18",draft:!1,tags:[],version:"current",sidebarPosition:18,frontMatter:{sidebar_position:18},sidebar:"backSidebar",previous:{title:"[TTA] dev-ops\uc758 \uac1c\ub1502",permalink:"/docs/dev-ops/dev-ops17"},next:{title:"[NestJS] \uc2dc\uc791 \uc804 \uc694\uad6c\uc0ac\ud56d",permalink:"/docs/nestjs/nodejs1"}},p={},s=[{value:"\uc624\ud508\uc18c\uc2a4 grafana",id:"\uc624\ud508\uc18c\uc2a4-grafana",level:2},{value:"\uac1c\ub150",id:"\uac1c\ub150",level:3},{value:"\uc815\ud615 \ub85c\uadf8 \uc608\uc2dc",id:"\uc815\ud615-\ub85c\uadf8-\uc608\uc2dc",level:3},{value:"Loki",id:"loki",level:2},{value:"key \ubc1c\uae09",id:"key-\ubc1c\uae09",level:3},{value:"promtail agent",id:"promtail-agent",level:3},{value:"dashboard",id:"dashboard",level:3},{value:"\uc624\ud508\uc18c\uc2a4 \ud504\ub85c\uba54\ud14c\uc6b0\uc2a4 \ub300\uc2dc\ubcf4\ub4dc",id:"\uc624\ud508\uc18c\uc2a4-\ud504\ub85c\uba54\ud14c\uc6b0\uc2a4-\ub300\uc2dc\ubcf4\ub4dc",level:2}],m={toc:s},c="wrapper";function u(e){let{components:n,...a}=e;return(0,l.kt)(c,(0,t.Z)({},m,a,{components:n,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"tta-grafana-\uc0ac\uc6a9"},"[TTA]"," grafana \uc0ac\uc6a9"),(0,l.kt)("hr",null),(0,l.kt)("h2",{id:"\uc624\ud508\uc18c\uc2a4-grafana"},"\uc624\ud508\uc18c\uc2a4 grafana"),(0,l.kt)("p",null,"\uadfc\ub370 grafana\ub294 AGPL\uc774\ub2e4."),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://grafana.com/auth/sign-in/"},"grafana \ub9c1\ud06c")),(0,l.kt)("h3",{id:"\uac1c\ub150"},"\uac1c\ub150"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"log")," : \uba54\uc2dc\uc9c0"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"traces")," \uc5f0\uad00\uad00\uacc4"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"metric"),": \uc131\ub2a5 \uc218\uce58"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"profile"),": \uc131\ub2a5\ub370\uc774\ud130 \uc218\uc9d1?"),(0,l.kt)("h3",{id:"\uc815\ud615-\ub85c\uadf8-\uc608\uc2dc"},"\uc815\ud615 \ub85c\uadf8 \uc608\uc2dc"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{"asctime": "2024-10-31 15:25:05,533", "levelname": "ERROR", "message": "division by zero", "funcName": "<module>", "lineno": 38, "exc_info": "Traceback (most recent call last):\\n  File \\"C:\\\\cicd\\\\dev-ops-test\\\\loki-cloud\\\\main.py\\", line 36, in <module>\\n    result = 1 / 0\\n             ~~^~~\\nZeroDivisionError: division by zero", "taskName": null}\n{"asctime": "2024-10-31 15:25:06,535", "levelname": "INFO", "message": "This is an INFO log message from my application.", "funcName": "<module>", "lineno": 23, "exc_info": null, "taskName": null}\n{"asctime": "2024-10-31 15:25:07,536", "levelname": "INFO", "message": "This is an INFO log message from my application.", "funcName": "<module>", "lineno": 23, "exc_info": null, "taskName": null}\n{"asctime": "2024-10-31 15:25:07,536", "levelname": "ERROR", "message": "division by zero", "funcName": "<module>", "lineno": 38, "exc_info": "Traceback (most recent call last):\\n  File \\"C:\\\\cicd\\\\dev-ops-test\\\\loki-cloud\\\\main.py\\", line 36, in <module>\\n    result = 1 / 0\\n             ~~^~~\\nZeroDivisionError: division by zero", "taskName": null}\n{"asctime": "2024-10-31 15:25:08,538", "levelname": "INFO", "message": "This is an INFO log message from my application.", "funcName": "<module>", "lineno": 23, "exc_info": null, "taskName": null}\n{"asctime": "2024-10-31 15:25:08,539", "levelname": "WARNING", "message": "This is a simulated ValueError!", "funcName": "<module>", "lineno": 30, "exc_info": null, "taskName": null}       \n{"asctime": "2024-10-31 15:25:09,540", "levelname": "INFO", "message": "This is an INFO log message from my application.", "funcName": "<module>", "lineno": 23, "exc_info": null, "taskName": null}\n{"asctime": "2024-10-31 15:25:09,541", "levelname": "WARNING", "message": "This is a simulated ValueError!", "funcName": "<module>", "lineno": 30, "exc_info": null, "taskName": null}       \n{"asctime": "2024-10-31 15:25:10,542", "levelname": "INFO", "message": "This is an INFO log message from my application.", "funcName": "<module>", "lineno": 23, "exc_info": null, "taskName": null}\n{"asctime": "2024-10-31 15:25:10,543", "levelname": "ERROR", "message": "division by zero", "funcName": "<module>", "lineno": 38, "exc_info": "Traceback (most recent call last):\\n  File \\"C:\\\\cicd\\\\dev-ops-test\\\\loki-cloud\\\\main.py\\", line 36, in <module>\\n    result = 1 / 0\\n             ~~^~~\\nZeroDivisionError: division by zero", "taskName": null}\n')),(0,l.kt)("p",null,"\uc704\ucc98\ub7fc \ub85c\uadf8 \uc791\uc131\ud558\uba74 \uc815\ud615\uc784."),(0,l.kt)("h2",{id:"loki"},"Loki"),(0,l.kt)("p",null,"Promtail\uc774\ub77c\ub294\uac8c \ub85c\uadf8\ud30c\uc77c \uc77d\uc5b4\uc11c ",(0,l.kt)("inlineCode",{parentName:"p"},"Loki"),"\ub85c \ubcf4\ub0c4"),(0,l.kt)("h3",{id:"key-\ubc1c\uae09"},"key \ubc1c\uae09"),(0,l.kt)("p",null,"grafana\uc5d0\uc11c ",(0,l.kt)("inlineCode",{parentName:"p"},"Security")," > ",(0,l.kt)("inlineCode",{parentName:"p"},"Access Policies"),"\uc5d0\uc11c \uc815\ucc45 \uc0dd\uc131\ud558\uace0"),(0,l.kt)("p",null,"add token\uc73c\ub85c key\ubc1c\uae09 \uac00\ub2a5"),(0,l.kt)("p",null,"realms\ub294 ",(0,l.kt)("inlineCode",{parentName:"p"},"all stacks")),(0,l.kt)("p",null,"\uad8c\ud55c\uc740 ",(0,l.kt)("inlineCode",{parentName:"p"},"log write"),"\ub9cc \uc8fc\uace0 \uc815\ucc45 \ub9cc\ub4e4\uc5c8\ub530."),(0,l.kt)("p",null,"\uadf8\ub9ac\uace0 ",(0,l.kt)("inlineCode",{parentName:"p"},"add token"),"\uc73c\ub85c \ud1a0\ud070 \uc0dd\uc131"),(0,l.kt)("h3",{id:"promtail-agent"},"promtail agent"),(0,l.kt)("p",null,"promtail \ub2e4\uc6b4\ub85c\ub4dc\ud574\uc57c\ud568."),(0,l.kt)("p",null,"(\uc5ec\uae30\uc5d0\uc11c)","[https://grafana.com/docs/loki/latest/send-data/promtail/installation/]"," \ub2e4\uc6b4\ub85c\ub4dc \ud560 \uc218 \uc788\ub530."),(0,l.kt)("p",null,"docker, helm, binary \ub4f1\ub4f1 \uc788\uc74c"),(0,l.kt)("p",null,"docker\ub85c \ud558\ub294 \uc608\uc2dc\ub294 \uc544\ub798\uc640 \uac19\ub2e4."),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"docker container pull\ud558\uae30")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"docker pull grafana/promtail:3.0.0\n")),(0,l.kt)("ol",{start:2},(0,l.kt)("li",{parentName:"ol"},"promtail yaml\ud30c\uc77c \uc0dd\uc131")),(0,l.kt)("p",null,"grafana \ud398\uc774\uc9c0\uc5d0\uc11c ",(0,l.kt)("inlineCode",{parentName:"p"},"launch")," \ub204\ub974\uace0 ",(0,l.kt)("inlineCode",{parentName:"p"},"Loki")," \uc5d0\uc11c ",(0,l.kt)("inlineCode",{parentName:"p"},"Send log")," \ud074\ub9ad\ud574\uc11c yaml\ud30c\uc77c \ubcf5\uc0ac"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"server:\n  http_listen_port: 9080\n  grpc_listen_port: 0\n\npositions:\n  filename: ./tmp/positions.yaml\n\nclients:\n  - url: https://1037811:<Your Grafana.com API Token>@logs-prod-030.grafana.net/loki/api/v1/push\n\n\nscrape_configs:\n  - job_name: app_logs\n    static_configs:\n      - targets:\n          - localhost\n        labels:\n          job: my-devops-practice\n          host: my-labtop\n        #   __path__: ./tmp/*.log\n          __path__: /var/log/*.log  # config for container\n")),(0,l.kt)("p",null,"container\ub294 /var/log \uc800\uac70 \uc368\uc57c\ud55c\ub2e4. \uc704\uc5d0\uaebc\ub294 windwos binary \uc804\uc6a9"),(0,l.kt)("ol",{start:3},(0,l.kt)("li",{parentName:"ol"},"docker run")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'docker run --name promtail --volume "$PWD/promtail:/etc/promtail" --volume "$PWD/tmp:/var/log" grafana/promtail:3.0.0 --config.file=/etc/promtail/config.yaml\n')),(0,l.kt)("p",null,"\uadf8\ub7fc \ud655\uc778\ud558\ub294 \ubc29\ubc95\uc740"),(0,l.kt)("p",null,"Home\uc5d0\uc11c ",(0,l.kt)("inlineCode",{parentName:"p"},"grafana")," ",(0,l.kt)("inlineCode",{parentName:"p"},"launch")," \ud074\ub9ad\ud574\uc11c cloud home\uc73c\ub85c \ub4e4\uc5b4\uac00\uc11c"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"Explore")," \ub4e4\uc5b4\uac00\uc11c ",(0,l.kt)("inlineCode",{parentName:"p"},"grafanacloud-<username>-logs"),"\uc744 \ub20c\ub978\ub2e4."),(0,l.kt)("p",null,"\uadf8\ub9ac\uace0 query\uc5d0\uc11c config.yaml\uc5d0 \uc785\ub825\ud588\ub358 ",(0,l.kt)("inlineCode",{parentName:"p"},"host: my-labtop"),"\uc744 \uc774\uc6a9\ud574\uc11c"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"host")," = ",(0,l.kt)("inlineCode",{parentName:"p"},"my-labtop"),"\uc744 \ub9cc\ub4e4\uc5b4\uc90c"),(0,l.kt)("p",null,"sync \ud558\uace0 live \ud558\uba74 \ub05d"),(0,l.kt)("p",null,"\uadfc\ub370 \uc2e4\uc81c app\uc744 \uc2e4\ud589\ud574\uc11c \ub85c\uadf8 \uc0dd\uc131\ub418\ub3c4\ub85d \ud574\uc57c\ud55c\ub2e4."),(0,l.kt)("p",null,"promtail\uc740 \ub85c\uadf8\ub97c \uc77d\uace0 \uc804\uc1a1\ub9cc\ud558\ub294 \uce5c\uad6c\uc784"),(0,l.kt)("h3",{id:"dashboard"},"dashboard"),(0,l.kt)("p",null,"\ub300\uc2dc\ubcf4\ub4dc \ub9cc\ub4e4\uc218 \uc788\ub294\ub370"),(0,l.kt)("p",null,"copy paste\ud560 \uc218 \uc788\uc74c."),(0,l.kt)("p",null,"copy \ud574\uc11c ",(0,l.kt)("inlineCode",{parentName:"p"},"Add")," > ",(0,l.kt)("inlineCode",{parentName:"p"},"Paste Panel")," \ud558\uba74 \uac00\ub2a5"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'sum by(level)(count_over_time({host="my-labtop"} |~ "info|INFO" [$__interval]))\n')),(0,l.kt)("p",null,"\ucffc\ub9ac\uac00 \uc704\ucc98\ub7fc \ub3fc\uc788\ub294\ub370 \uc911\uc694\ud55c \ubd80\ubd84\uc740 ",(0,l.kt)("inlineCode",{parentName:"p"},'{host="my-labtop"}')," \uc774\ubd80\ubd84\uc784."),(0,l.kt)("h2",{id:"\uc624\ud508\uc18c\uc2a4-\ud504\ub85c\uba54\ud14c\uc6b0\uc2a4-\ub300\uc2dc\ubcf4\ub4dc"},"\uc624\ud508\uc18c\uc2a4 \ud504\ub85c\uba54\ud14c\uc6b0\uc2a4 \ub300\uc2dc\ubcf4\ub4dc"),(0,l.kt)("p",null,"\ud504\ub85c\uba54\ud14c\uc6b0\uc2a4\ub294 apache\ub2e4."),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://artifacthub.io/packages/helm/prometheus-community/prometheus"},"prometheus \ub9c1\ud06c")))}u.isMDXComponent=!0}}]);