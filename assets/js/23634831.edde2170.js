"use strict";(self.webpackChunkblogsaurus=self.webpackChunkblogsaurus||[]).push([[64296],{3905:(t,e,n)=>{n.d(e,{Zo:()=>s,kt:()=>k});var a=n(67294);function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function l(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function o(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?l(Object(n),!0).forEach((function(e){r(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function i(t,e){if(null==t)return{};var n,a,r=function(t,e){if(null==t)return{};var n,a,r={},l=Object.keys(t);for(a=0;a<l.length;a++)n=l[a],e.indexOf(n)>=0||(r[n]=t[n]);return r}(t,e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(a=0;a<l.length;a++)n=l[a],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}var u=a.createContext({}),p=function(t){var e=a.useContext(u),n=e;return t&&(n="function"==typeof t?t(e):o(o({},e),t)),n},s=function(t){var e=p(t.components);return a.createElement(u.Provider,{value:e},t.children)},m="mdxType",c={inlineCode:"code",wrapper:function(t){var e=t.children;return a.createElement(a.Fragment,{},e)}},d=a.forwardRef((function(t,e){var n=t.components,r=t.mdxType,l=t.originalType,u=t.parentName,s=i(t,["components","mdxType","originalType","parentName"]),m=p(n),d=r,k=m["".concat(u,".").concat(d)]||m[d]||c[d]||l;return n?a.createElement(k,o(o({ref:e},s),{},{components:n})):a.createElement(k,o({ref:e},s))}));function k(t,e){var n=arguments,r=e&&e.mdxType;if("string"==typeof t||r){var l=n.length,o=new Array(l);o[0]=d;var i={};for(var u in e)hasOwnProperty.call(e,u)&&(i[u]=e[u]);i.originalType=t,i[m]="string"==typeof t?t:r,o[1]=i;for(var p=2;p<l;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},98338:(t,e,n)=>{n.r(e),n.d(e,{assets:()=>u,contentTitle:()=>o,default:()=>c,frontMatter:()=>l,metadata:()=>i,toc:()=>p});var a=n(87462),r=(n(67294),n(3905));const l={sidebar_position:10},o="[LLM] 10. Casual Attention",i={unversionedId:"llm/llm10",id:"llm/llm10",title:"[LLM] 10. Casual Attention",description:"---",source:"@site/docs/llm/llm10.md",sourceDirName:"llm",slug:"/llm/llm10",permalink:"/docs/llm/llm10",draft:!1,tags:[],version:"current",sidebarPosition:10,frontMatter:{sidebar_position:10},sidebar:"aiSidebar",previous:{title:"[LLM] 9. Self Attention",permalink:"/docs/llm/llm9"}},u={},p=[{value:"Casual Attention",id:"casual-attention",level:2},{value:"\uc65c \ub9c8\uc2a4\ud0b9 \ud558\ub098?",id:"\uc65c-\ub9c8\uc2a4\ud0b9-\ud558\ub098",level:3},{value:"\ub3d9\uc791\ud558\ub294 \ubc29\uc2dd",id:"\ub3d9\uc791\ud558\ub294-\ubc29\uc2dd",level:3},{value:"\uc2e4\uc2b5 \ucf54\ub4dc",id:"\uc2e4\uc2b5-\ucf54\ub4dc",level:2},{value:"\uc785\ub825 \ub370\uc774\ud130",id:"\uc785\ub825-\ub370\uc774\ud130",level:3},{value:"Attention Score (\uc6d0\ubcf8)",id:"attention-score-\uc6d0\ubcf8",level:3},{value:"\ub9c8\uc2a4\ud0b9 \ud589\ub82c",id:"\ub9c8\uc2a4\ud0b9-\ud589\ub82c",level:3},{value:"\ub9c8\uc2a4\ud0b9 \uc801\uc6a9\ub41c Attention Score",id:"\ub9c8\uc2a4\ud0b9-\uc801\uc6a9\ub41c-attention-score",level:3},{value:"Softmax \ud6c4 Attention Weight",id:"softmax-\ud6c4-attention-weight",level:3},{value:"\ucd5c\uc885 Attention Output",id:"\ucd5c\uc885-attention-output",level:3}],s={toc:p},m="wrapper";function c(t){let{components:e,...n}=t;return(0,r.kt)(m,(0,a.Z)({},s,n,{components:e,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"llm-10-casual-attention"},"[LLM]"," 10. Casual Attention"),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"casual-attention"},"Casual Attention"),(0,r.kt)("hr",null),(0,r.kt)("p",null,"Casual Attention\uc740 \ubbf8\ub798\uc758 \ub2e8\uc5b4\ub97c \ubcf4\uc9c0 \uc54a\uace0 \uc608\uce21\ud558\ub294 \ubc29\ubc95\uc785\ub2c8\ub2e4."),(0,r.kt)("p",null,"GPT \uac19\uc740 Autogressive \ubaa8\ub378\uc5d0\uc11c \uc911\uc694\ud55c \uac1c\ub150\uc774\ub77c\uace0 \ud569\ub2c8\ub2e4. \ubaa8\ub378\uc774 \ub2e4\uc74c \ub2e8\uc5b4\ub97c \uc608\uce21\ud560 \ub54c \uacfc\uac70\uc758 \uc815\ubcf4\ub9cc \uc0ac\uc6a9\ud558\ub3c4\ub85d \uac15\uc81c\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."),(0,r.kt)("p",null,"\uadf8\ub798\uc11c \uac04\ub2e8\ud558\uac8c \ub9d0\ud558\uba74 ",(0,r.kt)("strong",{parentName:"p"},"\ubbf8\ub798 \ub2e8\uc5b4\ub97c \uac00\ub9b4 \uc218 \uc788\ub3c4\ub85d \ub9c8\uc2a4\ud0b9")," \ud558\ub294 \uae30\uc220\uc774\ub77c\uace0 \ud569\ub2c8\ub2e4."),(0,r.kt)("h3",{id:"\uc65c-\ub9c8\uc2a4\ud0b9-\ud558\ub098"},"\uc65c \ub9c8\uc2a4\ud0b9 \ud558\ub098?"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"AI\uac00 \ud559\uc2b5\ud560 \ub54c \ubbf8\ub798 \ub2e8\uc5b4\ub97c \ubbf8\ub9ac \ubcf4\uba74 \ub2f5\uc744 \ubcf4\uace0 \ubb38\uc81c\ub97c \ud478\ub294 \uac83\uacfc \uac19\uc544\uc11c \ud559\uc2b5\uc774 \uc548\ub41c\ub2e4\uace0 \ud569\ub2c8\ub2e4.")),(0,r.kt)("h3",{id:"\ub3d9\uc791\ud558\ub294-\ubc29\uc2dd"},"\ub3d9\uc791\ud558\ub294 \ubc29\uc2dd"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\uc774\uc804 \ub2e8\uc5b4\ub4e4\ub9cc \ucc38\uace0\ud558\uace0 \ubbf8\ub798 \ub2e8\uc5b4\ub294 \ubabb\ubcf4\uac8c \uac00\ub9b0\ub2e4\ub294\ub370 \uc194\uc9c1\ud788 \uc774\ud574\ub294 \uac00\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.")),(0,r.kt)("h2",{id:"\uc2e4\uc2b5-\ucf54\ub4dc"},"\uc2e4\uc2b5 \ucf54\ub4dc"),(0,r.kt)("hr",null),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'import torch\n\n# 1. \uc785\ub825 \ub370\uc774\ud130 (\ub2e8\uc21c\ud55c 3\uac1c \ub2e8\uc5b4 \ubb38\uc7a5, 4\ucc28\uc6d0 \uc784\ubca0\ub529)\nseq_len = 3   # \ubb38\uc7a5 \uae38\uc774 (\uc608: "I love AI")\nembed_dim = 4  # \uc784\ubca0\ub529 \ucc28\uc6d0 (\uac01 \ub2e8\uc5b4\uac00 4\ucc28\uc6d0 \ubca1\ud130\ub85c \ud45c\ud604)\n\n# \uc608\uc81c \uc785\ub825 (\ub79c\ub364 \uac12, \uc2e4\uc81c\ub294 Transformer \uc784\ubca0\ub529 \uc0ac\uc6a9)\nx = torch.randn(seq_len, embed_dim)\nprint("\uc785\ub825 \ub370\uc774\ud130 (\ud1a0\ud070 \uc784\ubca0\ub529):\\n", x)\n\n# 2. Query, Key, Value \uc0dd\uc131 (Self-Attention\uc5d0\uc11c \uc0ac\uc6a9\ub428)\nW_q = torch.randn(embed_dim, embed_dim)  # Query \ubcc0\ud658 \ud589\ub82c\nW_k = torch.randn(embed_dim, embed_dim)  # Key \ubcc0\ud658 \ud589\ub82c\nW_v = torch.randn(embed_dim, embed_dim)  # Value \ubcc0\ud658 \ud589\ub82c\n\nQ = x @ W_q  # (3,4) x (4,4) = (3,4)\nK = x @ W_k\nV = x @ W_v\n\n\n\n# 3. Attention Score \uacc4\uc0b0 (Q @ K.T)\nattn_scores_no_scaling = torch.matmul(Q, K.T)\nattn_scores = torch.matmul(Q, K.T) / (embed_dim ** 0.5)\nprint("\\nAttention Score (\uc6d0\ubcf8):\\n", attn_scores)\n\n# 4. \ub9c8\uc2a4\ud0b9 \uc0dd\uc131 (\ubbf8\ub798 \ub2e8\uc5b4 \uac00\ub9ac\uae30)\nmask = torch.triu(torch.ones(seq_len, seq_len), diagonal=1)  # \uc0c1\uc0bc\uac01 \ud589\ub82c \uc0dd\uc131\nmask = mask.bool()  # Boolean \ud615\ud0dc\ub85c \ubcc0\ud658\nprint("\\n\ub9c8\uc2a4\ud0b9 \ud589\ub82c:\\n", mask)\n\n# 5. Attention Score\uc5d0 \ub9c8\uc2a4\ud0b9 \uc801\uc6a9\nattn_scores.masked_fill_(mask, float(\'-inf\'))  # \ubbf8\ub798 \ub2e8\uc5b4\ub97c -\u221e\ub85c \uc124\uc815\nprint("\\n\ub9c8\uc2a4\ud0b9 \uc801\uc6a9\ub41c Attention Score:\\n", attn_scores)\n\n# 6. Softmax \uc801\uc6a9 (\ud655\ub960\uac12\uc73c\ub85c \ubcc0\ud658)\nattn_weights = torch.softmax(attn_scores, dim=-1)\nprint("\\nSoftmax \ud6c4 Attention Weight:\\n", attn_weights)\n\n# 7. Attention \uac00\uc911\uce58 \uc801\uc6a9\ud558\uc5ec \ucd5c\uc885 \uac12 \uacc4\uc0b0 (\uac00\uc911\ud569)\noutput = attn_weights @ V  # (3,3) x (3,4) = (3,4)\nprint("\\n\ucd5c\uc885 Attention Output:\\n", output)\n\n')),(0,r.kt)("h3",{id:"\uc785\ub825-\ub370\uc774\ud130"},"\uc785\ub825 \ub370\uc774\ud130"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"\uc785\ub825 \ub370\uc774\ud130 (\ud1a0\ud070 \uc784\ubca0\ub529):\n tensor([[ 0.9811,  0.1954, -0.8982, -0.1720],\n        [-0.2018,  0.2038,  1.6621,  1.8928],\n        [ 0.3604, -0.5018,  1.4016, -0.6515]])\n")),(0,r.kt)("p",null,"\uc608\uc2dc \uc785\ub825 \ub370\uc774\ud130 \uc785\ub2c8\ub2e4."),(0,r.kt)("h3",{id:"attention-score-\uc6d0\ubcf8"},"Attention Score (\uc6d0\ubcf8)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Attention Score (\uc6d0\ubcf8):\n tensor([[-7.7534,  9.9981,  4.0247],\n        [ 0.6387,  9.6488,  5.9596],\n        [ 1.3511, 10.7251,  7.8433]])\n")),(0,r.kt)("p",null,"Self-Attention \ubc29\uc2dd\uc758 \uc810\uc218\uc785\ub2c8\ub2e4."),(0,r.kt)("h3",{id:"\ub9c8\uc2a4\ud0b9-\ud589\ub82c"},"\ub9c8\uc2a4\ud0b9 \ud589\ub82c"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"\ub9c8\uc2a4\ud0b9 \ud589\ub82c:\n tensor([[False,  True,  True],\n        [False, False,  True],\n        [False, False, False]])\n")),(0,r.kt)("p",null,"\uc0c1\uc0bc\uac01\ud589\ub82c\uc744 \uc774\uc6a9\ud558\uc5ec \ub9c8\uc2a4\ud0b9\uc744 \uc124\uc815\ud588\uc2b5\ub2c8\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"mask = torch.triu(torch.ones(seq_len, seq_len), diagonal=1)\n")),(0,r.kt)("p",null,"pytorch\uc5d0\uc11c triu\ud568\uc218\ub97c \uc4f0\uba74 \uc0c1\uc0bc\uac01\ud589\ub82c\uc744 \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294\ub370 \uc544\ub798 \ucc98\ub7fc \ub098\uc635\ub2c8\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"1 1 1 1\n0 1 1 1\n0 0 1 1\n0 0 0 1\n")),(0,r.kt)("p",null,"diagonal=1\uc744 \uc0ac\uc6a9\ud558\uba74"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"0 1 1 1\n0 0 1 1\n0 0 0 1\n0 0 0 0\n")),(0,r.kt)("p",null,"\uc774\ub807\uac8c \ubcc0\ud658\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u2705 \ub9c8\uc2a4\ud0b9\uc744 \uc65c \uc774\ub807\uac8c \ud558\ub098\uc694?",(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"  - \uc774\ub807\uac8c \ub9c8\uc2a4\ud0b9 \ubc29\uc2dd\uc73c\ub85c \ud558\uae30\ub85c \uc54c\uace0\ub9ac\uc998 \uc801\uc73c\ub85c \uc815\ud574\uc838\uc788\ub294 \uac83\uc785\ub2c8\ub2e4.\n")))),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"\ub2e8\uc5b4"),(0,r.kt)("th",{parentName:"tr",align:null},"\ub2e8\uc5b41"),(0,r.kt)("th",{parentName:"tr",align:null},"\ub2e8\uc5b42"),(0,r.kt)("th",{parentName:"tr",align:null},"\ub2e8\uc5b43"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"\ub2e8\uc5b41"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2705"),(0,r.kt)("td",{parentName:"tr",align:null},"\u274c"),(0,r.kt)("td",{parentName:"tr",align:null},"\u274c")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"\ub2e8\uc5b42"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2705"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2705"),(0,r.kt)("td",{parentName:"tr",align:null},"\u274c")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"\ub2e8\uc5b43"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2705"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2705"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2705")))),(0,r.kt)("p",null,"\uc704\uc640 \uac19\uc740 \ub9c8\uc2a4\ud0b9 \ubc29\uc2dd\uc774 \ub110\ub9ac \uc0ac\uc6a9\ub418\uace0 \uc788\ub2e4\uace0 \ud558\ub124\uc694."),(0,r.kt)("h3",{id:"\ub9c8\uc2a4\ud0b9-\uc801\uc6a9\ub41c-attention-score"},"\ub9c8\uc2a4\ud0b9 \uc801\uc6a9\ub41c Attention Score"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"\ub9c8\uc2a4\ud0b9 \uc801\uc6a9\ub41c Attention Score:\n tensor([[-7.7534,    -inf,    -inf],\n        [ 0.6387,  9.6488,    -inf],\n        [ 1.3511, 10.7251,  7.8433]])\n")),(0,r.kt)("p",null,"Attention Score (\uc6d0\ubcf8) \uc911 \ub9c8\uc2a4\ud0b9 \uac12 true\uc5d0 \uc704\uce58\ud558\ub294 \uc560\ub4e4\uc744 -inf\ub85c \ub3cc\ub9bd\ub2c8\ub2e4."),(0,r.kt)("h3",{id:"softmax-\ud6c4-attention-weight"},"Softmax \ud6c4 Attention Weight"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Softmax \ud6c4 Attention Weight:\n tensor([[1.0000e+00, 0.0000e+00, 0.0000e+00],\n        [1.2215e-04, 9.9988e-01, 0.0000e+00],\n        [8.0390e-05, 9.4686e-01, 5.3057e-02]])\n")),(0,r.kt)("p",null,"Softmax\ud568\uc218\ub97c \ub3cc\ub824\uc11c \ubcf4\uba74 -inf\uc778 \uacf3\uc740 \ubaa8\ub450 0\uc73c\ub85c \ubcc0\ud588\uc2b5\ub2c8\ub2e4."),(0,r.kt)("h3",{id:"\ucd5c\uc885-attention-output"},"\ucd5c\uc885 Attention Output"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"\ucd5c\uc885 Attention Output:\n tensor([[-1.3495, -0.0827, -0.4479, -0.8731],\n        [ 0.3756, -0.4200, -0.1823,  2.7832],\n        [ 0.2240, -0.2482, -0.3019,  2.6438]])\n")),(0,r.kt)("p",null,"value \uac12\uacfc \ud569\uccd0\uc9c4 \ucd5c\uc885 \uac12\uc744 \ud655\uc778\ud574\ubcf8\ub2e4\uba74 masking\uc774 \uc801\uc6a9\ub410\ub2e4\uace0 \ubcfc \uc218 \uc788\uc2b5\ub2c8\ub2e4."))}c.isMDXComponent=!0}}]);