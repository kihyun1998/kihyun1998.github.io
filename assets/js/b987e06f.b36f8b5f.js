"use strict";(self.webpackChunkblogsaurus=self.webpackChunkblogsaurus||[]).push([[9797],{3905:(e,t,a)=>{a.d(t,{Zo:()=>o,kt:()=>m});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function p(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var c=n.createContext({}),u=function(e){var t=n.useContext(c),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},o=function(e){var t=u(e.components);return n.createElement(c.Provider,{value:t},e.children)},i="mdxType",k={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,l=e.originalType,c=e.parentName,o=p(e,["components","mdxType","originalType","parentName"]),i=u(a),d=r,m=i["".concat(c,".").concat(d)]||i[d]||k[d]||l;return a?n.createElement(m,s(s({ref:t},o),{},{components:a})):n.createElement(m,s({ref:t},o))}));function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=a.length,s=new Array(l);s[0]=d;var p={};for(var c in t)hasOwnProperty.call(t,c)&&(p[c]=t[c]);p.originalType=e,p[i]="string"==typeof e?e:r,s[1]=p;for(var u=2;u<l;u++)s[u]=a[u];return n.createElement.apply(null,s)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},9798:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>k,frontMatter:()=>l,metadata:()=>p,toc:()=>u});var n=a(7462),r=(a(7294),a(3905));const l={sidebar_position:29},s="29. [BackEnd] AWS Secret Manager",p={unversionedId:"backend-master/backend29",id:"backend-master/backend29",title:"29. [BackEnd] AWS Secret Manager",description:"AWS Secret Manager",source:"@site/docs/backend-master/backend29.md",sourceDirName:"backend-master",slug:"/backend-master/backend29",permalink:"/docs/backend-master/backend29",draft:!1,tags:[],version:"current",sidebarPosition:29,frontMatter:{sidebar_position:29},sidebar:"backSidebar",previous:{title:"28. [BackEnd] AWS RDS",permalink:"/docs/backend-master/backend28"},next:{title:"30. [BackEnd]",permalink:"/docs/backend-master2/backend30"}},c={},u=[{value:"AWS Secret Manager",id:"aws-secret-manager",level:2},{value:"symmetric key \uc124\uc815",id:"symmetric-key-\uc124\uc815",level:2},{value:"\ubcf4\uc548 \uc554\ud638 \uc124\uc815",id:"\ubcf4\uc548-\uc554\ud638-\uc124\uc815",level:2},{value:"app.env\ub85c \uac00\uc838\uc624\uae30",id:"appenv\ub85c-\uac00\uc838\uc624\uae30",level:2},{value:"AWS CLI \uc124\uce58",id:"aws-cli-\uc124\uce58",level:3},{value:"\uc790\uaca9 \uc99d\uba85 \uc124\uc815",id:"\uc790\uaca9-\uc99d\uba85-\uc124\uc815",level:3},{value:"aws secret manager \uc0ac\uc6a9",id:"aws-secret-manager-\uc0ac\uc6a9",level:3},{value:"\uad8c\ud55c \ucd94\uac00",id:"\uad8c\ud55c-\ucd94\uac00",level:3},{value:"\uc870\ud68c",id:"\uc870\ud68c",level:3},{value:"jq \uc124\uce58",id:"jq-\uc124\uce58",level:3},{value:"jq\ub97c \ud65c\uc6a9\ud574\uc11c json \ub9cc\ub4e4\uae30",id:"jq\ub97c-\ud65c\uc6a9\ud574\uc11c-json-\ub9cc\ub4e4\uae30",level:3},{value:"app.env\uc5d0 \ub36e\uc5b4\uc4f0\uae30",id:"appenv\uc5d0-\ub36e\uc5b4\uc4f0\uae30",level:3},{value:"deploy.yaml \uc218\uc815",id:"deployyaml-\uc218\uc815",level:2},{value:"\ubc30\ud3ec\ud55c \uc774\ubbf8\uc9c0 \ud14c\uc2a4\ud2b8",id:"\ubc30\ud3ec\ud55c-\uc774\ubbf8\uc9c0-\ud14c\uc2a4\ud2b8",level:2},{value:"ecr \ub85c\uadf8\uc778",id:"ecr-\ub85c\uadf8\uc778",level:3},{value:"docker pull",id:"docker-pull",level:3},{value:"docker run",id:"docker-run",level:3}],o={toc:u},i="wrapper";function k(e){let{components:t,...l}=e;return(0,r.kt)(i,(0,n.Z)({},o,l,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"29-backend-aws-secret-manager"},"29. ","[BackEnd]"," AWS Secret Manager"),(0,r.kt)("h2",{id:"aws-secret-manager"},"AWS Secret Manager"),(0,r.kt)("hr",null),(0,r.kt)("p",null,"\ud658\uacbd\ubcc0\uc218\ub4e4\uc744 \uae43\ud5c8\ube0c \uc800\uc7a5\uc18c\uc5d0 \uc800\uc7a5\ud558\uba74 \uc548\uc804\ud558\uc9c0 \uc54a\uc73c\ub2c8 \uc0ac\uc6a9\ud574\uc57c \ud55c\ub2e4."),(0,r.kt)("p",null,"\ub3c8\uc744 \ub0b4\uc57c \ud55c\ub2e4\uace0 \ud558\ub294\ub370 \uc800\ub294 Other type\uc73c\ub85c \uc124\uc815\ud569\ub2c8\ub2e4."),(0,r.kt)("p",null,"app.env \ud658\uacbd \ubcc0\uc218\ub4e4\uc744 \ubaa8\ub450 \ucd94\uac00\ud569\ub2c8\ub2e4."),(0,r.kt)("p",null,"TOKEN_SYMMETRIC_KEY \ub294 32\uc790\ub9ac \uc554\ud638\ud0a4\uc778\ub370 \uc774\ub294 openssl\ub85c \uc124\uc815\ud560 \uc218 \uc788\ub2e4\uace0 \ud558\ub124\uc694"),(0,r.kt)("h2",{id:"symmetric-key-\uc124\uc815"},"symmetric key \uc124\uc815"),(0,r.kt)("hr",null),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"openssl rand -hex 64 | head -c 32\n")),(0,r.kt)("h2",{id:"\ubcf4\uc548-\uc554\ud638-\uc124\uc815"},"\ubcf4\uc548 \uc554\ud638 \uc124\uc815"),(0,r.kt)("hr",null),(0,r.kt)("p",null,"\uadf8\ub0e5 \ub9cc\ub4e4\uba74 \ub05d"),(0,r.kt)("h2",{id:"appenv\ub85c-\uac00\uc838\uc624\uae30"},"app.env\ub85c \uac00\uc838\uc624\uae30"),(0,r.kt)("hr",null),(0,r.kt)("p",null,"\uc774\uac78 \ud558\ub824\uba74 aws cli\ub97c \uc124\uce58\ud574\uc57c \ud55c\ub2e4\uace0 \ud558\ub124\uc694."),(0,r.kt)("h3",{id:"aws-cli-\uc124\uce58"},"AWS CLI \uc124\uce58"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/ko_kr/cli/latest/userguide/getting-started-install.html"},"\uc5ec\uae30"),"\uc5d0\uc11c \uc124\uce58\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."),(0,r.kt)("h3",{id:"\uc790\uaca9-\uc99d\uba85-\uc124\uc815"},"\uc790\uaca9 \uc99d\uba85 \uc124\uc815"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"aws configure\n")),(0,r.kt)("p",null,"aws IAM\uc5d0\uc11c \uc124\uc815\ud55c ACCESS KEY\uc640 secret key \uc785\ub825\ud558\ub77c\uace0 \ub098\uc634"),(0,r.kt)("p",null,"\uc800\ub294 \uc0dd\uc131\ud560 \ub54c \uc800\uc7a5\ud574\ub193\uace0 \ub124\uc774\ubc84 \uba54\uc77c\uc5d0 \ubcf4\ub0b4\ub1a8\ub124\uc694."),(0,r.kt)("p",null,"region\uc740 ap-northeast-2"),(0,r.kt)("p",null,"output format\uc740 json\uc73c\ub85c \ud574\uc11c \uc124\uc815\ud558\uba74 \ub05d\uc785\ub2c8\ub2e4."),(0,r.kt)("p",null,"\uacbd\ub85c\ub294 ",(0,r.kt)("inlineCode",{parentName:"p"},"~/.aws/credentials"),"\uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."),(0,r.kt)("h3",{id:"aws-secret-manager-\uc0ac\uc6a9"},"aws secret manager \uc0ac\uc6a9"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"aws secretsmanager help\n")),(0,r.kt)("p",null,"\ub85c \ub3c4\uc6c0\ub9d0 \ud655\uc778\ud560 \uc218 \uc788\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"aws secretsmanager get-secret-value --secret-id simple_bank\n")),(0,r.kt)("p",null,"\uc774\ub7f0\uc2dd\uc73c\ub85c \ud588\ub294\ub370 \uc548\ub41c\ub2e4\uace0 \ud569\ub2c8\ub2e4. \uad8c\ud55c \ucd94\uac00 \ud574\uc57c\ud569\ub2c8\ub2e4."),(0,r.kt)("h3",{id:"\uad8c\ud55c-\ucd94\uac00"},"\uad8c\ud55c \ucd94\uac00"),(0,r.kt)("p",null,"IAM > \uc0ac\uc6a9\uc790 \uadf8\ub8f9 > \uad8c\ud55c > \uad8c\ud55c \ucd94\uac00 > SecretsManagerReadWrite \uc815\ucc45 \uc5f0\uacb0"),(0,r.kt)("p",null,"\uc870\uae08 \uae30\ub2e4\ub9ac\uc2dc\uba74 \ub420\uac81\ub2c8\ub2e4."),(0,r.kt)("p",null,"\uad8c\ud55c \ucd94\uac00\ub97c \ud558\uc9c0 \uc54a\ub354\ub77c\ub3c4 ARN\uc73c\ub85c \uc785\ub825\ud558\uc2dc\uba74 \ub429\ub2c8\ub2e4."),(0,r.kt)("h3",{id:"\uc870\ud68c"},"\uc870\ud68c"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"aws secretsmanager get-secret-value --secret-id simple_bank --query SecretString --output text\n")),(0,r.kt)("p",null,"\uc774\ub807\uac8c \ud558\uba74 \ube44\ubc00 \uac12\uc744 json\uc73c\ub85c \uc870\ud68c\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."),(0,r.kt)("p",null,"\uadfc\ub370 \uc5b4\ub5bb\uac8c \uc774\uac78 \ubc1b\uc544\uc62c\uc9c0.."),(0,r.kt)("p",null,"jq\ub97c \uc0ac\uc6a9\ud55c\ub2e4\uace0 \ud55c\ub2e4."),(0,r.kt)("h3",{id:"jq-\uc124\uce58"},"jq \uc124\uce58"),(0,r.kt)("p",null,"\uc6b0\ubd84\ud22c\uc5d0\uc11c\ub294 \uc544\ub798 \uba85\ub839\uc5b4\ub85c \uc124\uce58\ud560 \uc218 \uc788\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"apt-get install jq\n")),(0,r.kt)("p",null,"\uc0ac\uc6a9\ubc95\uc740 ",(0,r.kt)("a",{parentName:"p",href:"https://jqlang.github.io/jq/manual/"},"\uc774\uacf3"),"\uc5d0 \uc788\uc2b5\ub2c8\ub2e4."),(0,r.kt)("h3",{id:"jq\ub97c-\ud65c\uc6a9\ud574\uc11c-json-\ub9cc\ub4e4\uae30"},"jq\ub97c \ud65c\uc6a9\ud574\uc11c json \ub9cc\ub4e4\uae30"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"aws secretsmanager get-secret-value --secret-id simple_bank --query SecretString --output text | jq 'to_entries'\n")),(0,r.kt)("p",null,"\uc704\ucc98\ub7fc jq\ub97c to_entries\ud558\uba74 json\uc73c\ub85c \ubc1b\uc544\uc640\uc9d1\ub2c8\ub2e4."),(0,r.kt)("p",null,"\uc544\ub798 \uba85\ub839\uc5b4\ub294 \ud0a4\ub9cc \ub098\uc624\uace0"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"aws secretsmanager get-secret-value --secret-id simple_bank --query SecretString --output text | jq 'to_entries|map(.key)'\n")),(0,r.kt)("p",null,"\uc544\ub798 \uba85\ub839\uc5b4\ub294 \uac12\ub9cc \ub098\uc635\ub2c8\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"aws secretsmanager get-secret-value --secret-id simple_bank --query SecretString --output text | jq 'to_entries|map(.value)'\n")),(0,r.kt)("p",null,"\uc544\ub798\ucc98\ub7fc string format\uc744 \ud574\uc11c app.env\uc5d0 \ub4e4\uc5b4\uac00\ub294 \uac12\uc744 \ub9cc\ub4e4 \uc218 \uc788\uc2b5\ub2c8\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"aws secretsmanager get-secret-value --secret-id simple_bank --query SecretString --output text | jq 'to_entries|map(\"\\(.key)=\\(.value)\")'\n")),(0,r.kt)("p",null,"\uadf8\ub9ac\uace0 \ub9c8\uc9c0\ub9c9\uc73c\ub85c ",(0,r.kt)("inlineCode",{parentName:"p"},".[]"),"\ub97c \ucd94\uac00\ud558\uc5ec \ubc30\uc5f4\uc801\uc778 \ubd80\ubd84\uc744 \uc81c\uac70\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"aws secretsmanager get-secret-value --secret-id simple_bank --query SecretString --output text | jq 'to_entries|map(\"\\(.key)=\\(.value)\")|.[]'\n")),(0,r.kt)("p",null,"\uc9c4\uc9dc \ub9c8\uc9c0\ub9c9\uc73c\ub85c ",(0,r.kt)("inlineCode",{parentName:"p"},"-r")," \uc635\uc158\uc744 \uc0ac\uc6a9\ud558\uc5ec \ub530\uc634\ud45c\ub97c \uc81c\uac70\ud569\ub2c8\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"aws secretsmanager get-secret-value --secret-id simple_bank --query SecretString --output text | jq -r 'to_entries|map(\"\\(.key)=\\(.value)\")|.[]'\n")),(0,r.kt)("p",null,"\uc774\uc81c \uc774 \ucd9c\ub825\uc744 redirection \ud574\uc11c app.env\uc5d0 \ub36e\uc5b4\uc4f0\uae30 \ud558\ub294 \uac83\uc774 \ub0a8\uc558\uc2b5\ub2c8\ub2e4."),(0,r.kt)("h3",{id:"appenv\uc5d0-\ub36e\uc5b4\uc4f0\uae30"},"app.env\uc5d0 \ub36e\uc5b4\uc4f0\uae30"),(0,r.kt)("p",null,"app.env\uc640 \ub3d9\uc77c\ud55c \ub514\ub809\ud1a0\ub9ac\uc5d0\uc11c \uc9c4\ud589\ud55c\ub2e4\ub294 \uac00\uc815\ud558\uc5d0 \uc544\ub798 \uba85\ub839\uc5b4\ub97c \uc0ac\uc6a9\ud558\uba74 \ub429\ub2c8\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"aws secretsmanager get-secret-value --secret-id simple_bank --query SecretString --output text | jq -r 'to_entries|map(\"\\(.key)=\\(.value)\")|.[]' > app.env\n")),(0,r.kt)("h2",{id:"deployyaml-\uc218\uc815"},"deploy.yaml \uc218\uc815"),(0,r.kt)("hr",null),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"...\n      - name: \ud83d\udcc0 Load secrets and save to app.env\n        run: aws secretsmanager get-secret-value --secret-id simple_bank --query SecretString --output text | jq -r 'to_entries|map(\"\\(.key)=\\(.value)\")|.[]' > app.env\n...\n")),(0,r.kt)("p",null,"deploy.yaml\uc5d0 \uc704 \ubd80\ubd84\uc744 \ucd94\uac00\ud569\ub2c8\ub2e4."),(0,r.kt)("h2",{id:"\ubc30\ud3ec\ud55c-\uc774\ubbf8\uc9c0-\ud14c\uc2a4\ud2b8"},"\ubc30\ud3ec\ud55c \uc774\ubbf8\uc9c0 \ud14c\uc2a4\ud2b8"),(0,r.kt)("hr",null),(0,r.kt)("h3",{id:"ecr-\ub85c\uadf8\uc778"},"ecr \ub85c\uadf8\uc778"),(0,r.kt)("p",null,"\uc790\uc138\ud55c \uc124\uba85\uc740 ",(0,r.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/cli/latest/reference/ecr/get-login-password.html"},"\uc774\uacf3"),"\uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"aws ecr get-login-password | docker login --username AWS --password-stdin <ECR \uc800\uc7a5\uc18c URL\uc5d0\uc11c \ub4a4\uc5d0 / \ub4a4\uc5d0 \ube80 \ubd80\ubd84>\n")),(0,r.kt)("h3",{id:"docker-pull"},"docker pull"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker pull <\uc774\ubbf8\uc9c0 URL>\n")),(0,r.kt)("p",null,"\ud655\uc778\ud574\ubcfc \uc774\ubbf8\uc9c0 ",(0,r.kt)("inlineCode",{parentName:"p"},"URL"),"\uc744 \ubcf5\uc0ac\ud574\uc11c \ubd99\uc5ec\ub123\uc2b5\ub2c8\ub2e4. \ud0dc\uadf8\uac00 \uc544\ub2c8\ub77c ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"URL"))),(0,r.kt)("p",null,"\uadfc\ub370 \ubc14\ub85c \uc548\ub420 \uac83\uc785\ub2c8\ub2e4."),(0,r.kt)("p",null,"start.sh\uc5d0 \uc544\ub798 \ucd94\uac00\ud574\uc918\uc57c \ud569\ub2c8\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"source /app/app.env\n")),(0,r.kt)("p",null,"\uadf8\ub798\uc57c app.env \ub3d9\uae30\ud654\ub41c\ub2e4."),(0,r.kt)("h3",{id:"docker-run"},"docker run"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker run -p 8080:8080 <\uc774\ubbf8\uc9c0 URL>\n")),(0,r.kt)("p",null,"\uc774\ub7ec\uba74 \uc6d0\ub798 \uc2e4\ud589\uc774 \ub418\uc57c \ud569\ub2c8\ub2e4."),(0,r.kt)("p",null,"\uadfc\ub370 \uc800\ub294 \uc2e4\ud589\uc774 \uc548\ub410\uc5c8\uc2b5\ub2c8\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'docker: Error response from daemon: failed to create task for container: failed to create shim task: OCI runtime create failed: runc create failed: unable to start container process: exec: "/app/start.sh": permission denied: unknown.\n')),(0,r.kt)("p",null,"\uc774\ub7f0 \uc5d0\ub7ec\uac00 \ub0ac\uc5c8\uc2b5\ub2c8\ub2e4."),(0,r.kt)("p",null,"Dockerfile\uc744 \uc218\uc815\ud574\uc11c \ud574\uacb0\ud588\uc2b5\ub2c8\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"...\nRUN chmod +x /app/start.sh\n...\n")),(0,r.kt)("p",null,"\uc774 \ucf54\ub4dc\ub97c ENTRYPOINT\ud558\uae30 \uc804\uc804\uc804\uc5d0 \ub123\uc5b4\uc8fc\ub2c8 \ud574\uacb0\ud588\uc2b5\ub2c8\ub2e4."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Alt text",src:a(6795).Z,width:"1027",height:"501"})))}k.isMDXComponent=!0},6795:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/image1-643933329d3a511621d166b00bf673de.png"}}]);