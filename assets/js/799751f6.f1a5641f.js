"use strict";(self.webpackChunkblogsaurus=self.webpackChunkblogsaurus||[]).push([[1231],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>k});var a=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var p=a.createContext({}),s=function(e){var n=a.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},u=function(e){var n=s(e.components);return a.createElement(p.Provider,{value:n},e.children)},d="mdxType",c={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,l=e.originalType,p=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),d=s(t),m=r,k=d["".concat(p,".").concat(m)]||d[m]||c[m]||l;return t?a.createElement(k,o(o({ref:n},u),{},{components:t})):a.createElement(k,o({ref:n},u))}));function k(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var l=t.length,o=new Array(l);o[0]=m;var i={};for(var p in n)hasOwnProperty.call(n,p)&&(i[p]=n[p]);i.originalType=e,i[d]="string"==typeof e?e:r,o[1]=i;for(var s=2;s<l;s++)o[s]=t[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},40256:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>o,default:()=>c,frontMatter:()=>l,metadata:()=>i,toc:()=>s});var a=t(87462),r=(t(67294),t(3905));const l={sidebar_position:15},o="[Github Actions] Self-hosted runner\ub85c Golang CI \ud558\uae30",i={unversionedId:"dev-ops/dev-ops15",id:"dev-ops/dev-ops15",title:"[Github Actions] Self-hosted runner\ub85c Golang CI \ud558\uae30",description:"---",source:"@site/docs/dev-ops/dev-ops15.md",sourceDirName:"dev-ops",slug:"/dev-ops/dev-ops15",permalink:"/docs/dev-ops/dev-ops15",draft:!1,tags:[],version:"current",sidebarPosition:15,frontMatter:{sidebar_position:15},sidebar:"backSidebar",previous:{title:"[Github Actions] Self-hosted runner for RedHat 9.x",permalink:"/docs/dev-ops/dev-ops14"},next:{title:"[TTA] dev-ops\uc758 \uac1c\ub150",permalink:"/docs/dev-ops/dev-ops16"}},p={},s=[{value:"\ud3f4\ub354\uad6c\uc870",id:"\ud3f4\ub354\uad6c\uc870",level:2},{value:"trigger on",id:"trigger-on",level:2},{value:"jobs",id:"jobs",level:2},{value:"\ucf54\ub4dc clone",id:"\ucf54\ub4dc-clone",level:3},{value:"\ud30c\uc77c \uc774\ub984 \ud658\uacbd\ubcc0\uc218 \uc124\uc815",id:"\ud30c\uc77c-\uc774\ub984-\ud658\uacbd\ubcc0\uc218-\uc124\uc815",level:3},{value:"golang env \uc124\uc815",id:"golang-env-\uc124\uc815",level:3},{value:"git config",id:"git-config",level:3},{value:"go get",id:"go-get",level:3},{value:"test, build",id:"test-build",level:3},{value:"tar\ub85c \ubb36\uae30",id:"tar\ub85c-\ubb36\uae30",level:3},{value:"\ubc30\ud3ec \uc11c\ubc84\uc5d0 sftp \uc804\uc1a1",id:"\ubc30\ud3ec-\uc11c\ubc84\uc5d0-sftp-\uc804\uc1a1",level:3},{value:"clean up",id:"clean-up",level:3}],u={toc:s},d="wrapper";function c(e){let{components:n,...l}=e;return(0,r.kt)(d,(0,a.Z)({},u,l,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"github-actions-self-hosted-runner\ub85c-golang-ci-\ud558\uae30"},"[Github Actions]"," Self-hosted runner\ub85c Golang CI \ud558\uae30"),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"\ud3f4\ub354\uad6c\uc870"},"\ud3f4\ub354\uad6c\uc870"),(0,r.kt)("p",null,"private organization\uc758 private repository\ub85c \ucabc\uac1c\uc9c4 golang \ucf54\ub4dc\ub4e4\uc744 CI\ud558\ub294 \ud14c\uc2a4\ud2b8 \uc608\uc81c\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"\u251c\u2500\u2500 Binary\n\u2502   \u251c\u2500\u2500 wadd\n\u2502   \u251c\u2500\u2500 wsub\n\u2502   \u251c\u2500\u2500 wmul\n\u2502   \u2514\u2500\u2500 wdiv\n\u251c\u2500\u2500 Library\n\u2502   \u251c\u2500\u2500 libRandom\n\u2502   \u2514\u2500\u2500 libCalculator\n\u2514\u2500\u2500 CI\n")),(0,r.kt)("p",null,"\uc2e4\uc81c\ub85c\ub294 repository\ub85c \ub2e4 \ucabc\uac1c\uc838 \uc788\ub2e4."),(0,r.kt)("p",null,"CI\uc5d0\ub294 \uc800 \ubaa8\ub4e0 repository\ub97c clone\ud574\uc11c test\uc640 build\ub97c \ud558\ub294 \uac83\uc744 \ubaa9\ud45c\ub85c \ud558\uace0 \uc788\ub2e4."),(0,r.kt)("h2",{id:"trigger-on"},"trigger on"),(0,r.kt)("hr",null),(0,r.kt)("p",null,"\uc5b4\ub5a8 \ub54c workflow\ub97c \uc2dc\uc791\ud560 \uc9c0 \uc815\ud560 \uc218 \uc788\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'on:\n  push:\n    tags:\n      - \'V*\'\n  workflow_dispatch:\n    inputs:\n      file_name:\n        description: "Main File Name"\n        required: true\n        default: "FILE_NAME_VX.X.X(YYYY-MM-DD)"\n')),(0,r.kt)("p",null,"\uba3c\uc800 ",(0,r.kt)("inlineCode",{parentName:"p"},"push tags"),"\uc778\ub370 \uc815\ud574\ub193\uc740 ",(0,r.kt)("inlineCode",{parentName:"p"},"V*"),"\ub85c \uc2dc\uc791\ud558\ub294 tag\uac00 push\ub418\uc5b4\uc57c workflow\ub97c \uc2dc\uc791\ud558\ub294 \uac83\uc774\ub2e4."),(0,r.kt)("p",null,"\ub2e4\uc74c\uc73c\ub85c\ub294 workflow_dispatch\uc778\ub370 \uc774\ub294 workflow \uc6f9 \uc0ac\uc774\ud2b8\uc5d0\uc11c \ubc84\ud2bc\uc744 \ud1b5\ud574 \uc218\ub3d9\uc73c\ub85c \uc2dc\uc791\ud558\ub294 \uac83\uc774\ub2e4."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"alt text",src:t(80809).Z,width:"1917",height:"611"})),(0,r.kt)("p",null,"branch\ub3c4 \uc815\ud560 \uc218 \uc788\uace0 \uc124\uc815\ud55c ",(0,r.kt)("inlineCode",{parentName:"p"},"file_name")," \uac12\ub3c4 \uc218\ub3d9\uc73c\ub85c \uc815\ud560 \uc218 \uc788\ub2e4."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"inputs"),"\uc5d0\ub294\n\uc81c\ubaa9\uc744 \ub73b\ud558\ub294 ",(0,r.kt)("inlineCode",{parentName:"p"},"description"),"\uacfc",(0,r.kt)("br",{parentName:"p"}),"\n","\ud544\uc218 \uc5ec\ubd80\uc778 ",(0,r.kt)("inlineCode",{parentName:"p"},"required"),",",(0,r.kt)("br",{parentName:"p"}),"\n","\uadf8\ub9ac\uace0 \uae30\ubcf8\uc73c\ub85c \ub4e4\uc5b4\uac00 \uc788\ub294 \uac12\uc778 ",(0,r.kt)("inlineCode",{parentName:"p"},"default"),"\uac00 \uc788\ub2e4."),(0,r.kt)("h2",{id:"jobs"},"jobs"),(0,r.kt)("hr",null),(0,r.kt)("h3",{id:"\ucf54\ub4dc-clone"},"\ucf54\ub4dc clone"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"build-and-test:\n    name: \ud83e\uddbe Unit Test & Build\n    runs-on: self-hosted\n    steps:\n    - name: \u2705 Checkout CI Repository\n      uses: actions/checkout@v3\n\n    - name: \u2705 Checkout Add Repository\n      uses: actions/checkout@v3\n      with:\n        repository: 'TeamMakeCalculator/wadd'\n        path: 'wadd'\n        token: ${{secrets.GH_TOEKN}}\n\n    ...\n")),(0,r.kt)("p",null,"\uadf8\ub0e5 clone\uc744 \ud574\ub3c4 \ub418\ub294\ub370 ",(0,r.kt)("inlineCode",{parentName:"p"},"actions/checkout@v3"),"\uc744 \uc0ac\uc6a9\ud588\ub2e4. \uc880\ub354 \ubcf4\uc548\uc131\uc774 \uc88b\uc544\ubcf4\uc5ec\uc11c"),(0,r.kt)("p",null,"secrets.GH_TOKEN\uc740 PAT\ub77c\uace0 Personal Access Token\uc774\ub2e4."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Github")," > ",(0,r.kt)("inlineCode",{parentName:"p"},"Settings")," > ",(0,r.kt)("inlineCode",{parentName:"p"},"Developer Settings")," > ",(0,r.kt)("inlineCode",{parentName:"p"},"Personal access tokens")," > ",(0,r.kt)("inlineCode",{parentName:"p"},"Tokens(classic)")," > ",(0,r.kt)("inlineCode",{parentName:"p"},"Generate new token(classic)")),(0,r.kt)("p",null,"\uacbd\ub85c\uc5d0\uc11c \ubc1c\uae09\ubc1b\uc744 \uc218 \uc788\ub2e4. \ubc1c\uae09 \ubc1b\uc740 \ud1a0\ud070\uc740 "),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"\uc800\uc7a5\uc18c")," > ",(0,r.kt)("inlineCode",{parentName:"p"},"Settings")," > ",(0,r.kt)("inlineCode",{parentName:"p"},"Secrets and variables")," > ",(0,r.kt)("inlineCode",{parentName:"p"},"Actions")," > ",(0,r.kt)("inlineCode",{parentName:"p"},"New repository secret"),"\uc5d0\uc11c \ub4f1\ub85d\ud560 \uc218 \uc788\ub2e4."),(0,r.kt)("h3",{id:"\ud30c\uc77c-\uc774\ub984-\ud658\uacbd\ubcc0\uc218-\uc124\uc815"},"\ud30c\uc77c \uc774\ub984 \ud658\uacbd\ubcc0\uc218 \uc124\uc815"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"    - name: \ud83d\udcbe If push tag, Register Tag name in env\n      if: ${{github.event_name == 'push'}}\n      run: | \n        echo \"TAG_NAME=$(echo ${{ github.ref_name }})($(date +'%Y-%m-%d'))\" >> $GITHUB_ENV\n    - name: \ud83d\udcbe If push tag, Register File name in env\n      if: ${{github.event_name == 'push'}}\n      run: | \n        echo \"FILE_NAME=Random_Calculator_${{env.TAG_NAME}}\" >> $GITHUB_ENV\n\n    - name: \ud83d\udcbe If workflow_dispatch, Register File name in env\n      if: ${{github.event_name == 'workflow_dispatch'}}\n      run: | \n        echo \"FILE_NAME=${{github.event.inputs.file_name}}\" >> $GITHUB_ENV\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"if"),"\ub97c \uc0ac\uc6a9\ud574\uc11c ",(0,r.kt)("inlineCode",{parentName:"p"},"push"),"\uc778\uc9c0 ",(0,r.kt)("inlineCode",{parentName:"p"},"workflow_dispatch"),"\uc778\uc9c0 \uad6c\ubd84\uc744 \uba3c\uc800 \ud569\ub2c8\ub2e4."),(0,r.kt)("p",null,"tag\ub97c push\ud55c \uacbd\uc6b0\uc5d0\ub294 ",(0,r.kt)("inlineCode",{parentName:"p"},"github.ref_name"),"\uc744 \uc0ac\uc6a9\ud574\uc11c file name\uc744 \uc5bb\uace0",(0,r.kt)("br",{parentName:"p"}),"\n","\uc218\ub3d9\uc778 \uacbd\uc6b0\uc5d0\ub294 ",(0,r.kt)("inlineCode",{parentName:"p"},"github.event.inputs.file_name"),"\uc744 \uc0ac\uc6a9\ud574\uc11c file name\uc744 \uc5bb\uc2b5\ub2c8\ub2e4."),(0,r.kt)("p",null,"\uc774\ub294 \ub098\uc911\uc5d0 Makefile\uc5d0\uc11c \uc544\ub798\uc640 \uac19\uc774 \uc791\uc6a9\ud569\ub2c8\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"tar:\n    @cd bin && tar -cvf ../'$(FILE_NAME)'.tar *\n")),(0,r.kt)("h3",{id:"golang-env-\uc124\uc815"},"golang env \uc124\uc815"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"    - name: \ud83e\uddd9 Config GO env\n      run: |\n        go env -w GOPRIVATE=github.com/TeamMakeCalculator\n")),(0,r.kt)("p",null,"GOPRIVATE\ub97c \uc124\uc815\ud574\uc11c private repository\ub3c4 go get\ud560 \uc218 \uc788\ub3c4\ub85d \ud574\uc90d\ub2c8\ub2e4."),(0,r.kt)("h3",{id:"git-config"},"git config"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'    - name: \ud83e\uddd9 Config Git\n      run: |\n        git config --global --add safe.directory $GITHUB_WORKSPACE\n        git config --global url."https://${{secrets.GIT_USERNAME}}:${{secrets.GH_TOEKN}}@github.com/TeamMakeCalculator".insteadOf "https://github.com/TeamMakeCalculator"\n')),(0,r.kt)("p",null,"workspace\ub97c safe directory\ub85c \uc9c0\uc815\ud558\uace0 private repository go get\uc744 \uc704\ud574\uc11c \ubbf8\ub9ac \uc778\uc99d\uc744 \ud574\ub193\uc2b5\ub2c8\ub2e4."),(0,r.kt)("h3",{id:"go-get"},"go get"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"    - name: \ud83d\udd25 Get dependencies\n      run: |\n        go mod init\n        go mod tidy\n")),(0,r.kt)("p",null,"\uc815\uc0c1\uc801\uc778 \ubc29\ubc95\uc73c\ub85c go get\uc744 \ud569\ub2c8\ub2e4."),(0,r.kt)("p",null,"go mod tidy\uc5d0\uc11c \uc548\ub418\ub294 \uacbd\uc6b0\uc5d0\ub294 \uc9c1\uc811 \ub4e4\uc5b4\uac00\uc11c \ud574\ubcf4\ub294\uac8c \uc88b\uace0"),(0,r.kt)("p",null,"\uc800\uac19\uc740 \uacbd\uc6b0\uc5d0\ub294 GOPATH\uc5d0 \ub450\uc9c0 \uc54a\uc558\uc5b4\uc11c \uc548\ub410\ub294\ub370 GOPATH\uc5d0 \ub450\uc9c0 \uc54a\ub354\ub77c\ub3c4 go mod init \ud560 \ub54c \uc774\ub984\uc744 \uc9c0\uc815\ud574\uc8fc\uba74 \uad1c\ucc2e\ub2e4\uace0 \ud558\ub354\ub77c\uad6c\uc694."),(0,r.kt)("h3",{id:"test-build"},"test, build"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"    - name: \ud83d\udcbd Test\n      run: make test\n\n    - name: \ud83d\udee0\ufe0f Build\n      run: make build\n")),(0,r.kt)("p",null,"test\uc640 build\ub294 \uc704\ucc98\ub7fc \uac04\ub2e8\ud55c\ub370 Makefile\uc744 \ubcf4\uba74"),(0,r.kt)("p",null,"\uc774\ub807\uac8c \uc801\ub2f9\ud788 \ud3f4\ub354 \uc704\uce58\ub9cc \uc798 \ub9de\ucdb0\uc8fc\uba74 \uac04\ub2e8\ud558\uac8c \uc798 \ub429\ub2c8\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"build:\n    go build -o wadd ./wadd\n    go build -o wsub ./wsub\n    go build -o wmul ./wmul\n    go build -o wdiv ./wdiv\n\ntest:\n    go test -v -cover ./wadd/...\n    go test -v -cover ./wsub/...\n    go test -v -cover ./wmul/...\n    go test -v -cover ./wdiv/...\n")),(0,r.kt)("h3",{id:"tar\ub85c-\ubb36\uae30"},"tar\ub85c \ubb36\uae30"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"    - name: \ud83d\ude9a Collect binary\n      run: make move\n\n    - name: \ud83d\udd25 Compress with tar\n      run: make tar\n")),(0,r.kt)("p",null,"\uc774\uac70\ub3c4 Makefile\ub85c \ub9cc\ub4e4\uc5c8\uc2b5\ub2c8\ub2e4."),(0,r.kt)("p",null,"\ud769\uc5b4\uc838\uc788\ub294 \ubc14\uc774\ub108\ub9ac\ub97c \ubaa8\uc544\uc11c tar\ub85c \ubb36\ub294 \uc608\uc81c\uc785\ub2c8\ub2e4."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"BINPATH=./bin\n\nmove:\n    @mkdir -p ./bin\n    @mv ./wadd/wadd $(BINPATH)\n    @mv ./wsub/wsub $(BINPATH)\n    @mv ./wmul/wmul $(BINPATH)\n    @mv ./wdiv/wdiv $(BINPATH)\n\ntar:\n    @cd bin && tar -cvf ../'$(FILE_NAME)'.tar *\n")),(0,r.kt)("h3",{id:"\ubc30\ud3ec-\uc11c\ubc84\uc5d0-sftp-\uc804\uc1a1"},"\ubc30\ud3ec \uc11c\ubc84\uc5d0 sftp \uc804\uc1a1"),(0,r.kt)("hr",null),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'    - name: \ud83d\ude80 Transfer files use SFTP\n      uses: appleboy/scp-action@master\n      with:\n        host: 192.168.135.81\n        username: ${{secrets.SFTP_USERNAME}}\n        password: ${{secrets.SFTP_PASSWORD}}\n        source: "${{env.FILE_NAME}}.tar"\n        target: "~/"\n')),(0,r.kt)("p",null,"\ubc30\ud3ec \uc11c\ubc84\uc758 \uc544\uc774\ub514 \ud328\uc2a4\uc6cc\ub4dc\ub97c \uc54c\uba74 \uc774\uac8c \uc81c\uc77c \uac04\ub2e8\ud574\uc11c \uc774\ub807\uac8c \uc9c4\ud589\ud588\uc2b5\ub2c8\ub2e4."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"key:"),"\ub77c\ub294 \uac12\uc5d0 ssh\ud0a4\ub97c \ub123\uace0\ub3c4 \uc9c4\ud589\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"source"),"\ub294 \ubcf4\ub0bc \ud30c\uc77c \uc774\ub984\uc774\uace0 ",(0,r.kt)("inlineCode",{parentName:"p"},"target"),"\uc740 \ubc30\ud3ec\uc11c\ubc84\uc5d0 \uc5b4\ub514\uc5d0 \ub193\uc744\uc9c0 \uacbd\ub85c\uc785\ub2c8\ub2e4."),(0,r.kt)("h3",{id:"clean-up"},"clean up"),(0,r.kt)("hr",null),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"    - name: \ud83e\uddf9 Clean up local directory\n      run: rm -rf ${{ github.workspace }}/*\n")),(0,r.kt)("p",null,"\uc774\ub807\uac8c\ub9cc \uc9c0\uc6c1\ub2c8\ub2e4. "),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"${{ github.workspace }}/../*")," \uc774\ub807\uac8c\ub3c4 \uc9c0\uc6b8 \uc218 \uc788\ub294\ub370 checkout\ud560 \ub54c \uc5d0\ub7ec\uac00 \ub098\ub354\ub77c\uad6c\uc694."),(0,r.kt)("p",null,"\uc774\ub7ec\uba74 \ub05d !"))}c.isMDXComponent=!0},80809:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/image-1-bdbc7ce7d7bf6736d9e9d72fbeadba74.png"}}]);