"use strict";(self.webpackChunkblogsaurus=self.webpackChunkblogsaurus||[]).push([[44387],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>m});var r=t(67294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function s(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?s(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)t=s[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)t=s[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var c=r.createContext({}),i=function(e){var n=r.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},u=function(e){var n=i(e.components);return r.createElement(c.Provider,{value:n},e.children)},p="mdxType",k={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},d=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,s=e.originalType,c=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),p=i(t),d=a,m=p["".concat(c,".").concat(d)]||p[d]||k[d]||s;return t?r.createElement(m,l(l({ref:n},u),{},{components:t})):r.createElement(m,l({ref:n},u))}));function m(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var s=t.length,l=new Array(s);l[0]=d;var o={};for(var c in n)hasOwnProperty.call(n,c)&&(o[c]=n[c]);o.originalType=e,o[p]="string"==typeof e?e:a,l[1]=o;for(var i=2;i<s;i++)l[i]=t[i];return r.createElement.apply(null,l)}return r.createElement.apply(null,t)}d.displayName="MDXCreateElement"},38588:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>k,frontMatter:()=>s,metadata:()=>o,toc:()=>i});var r=t(87462),a=(t(67294),t(3905));const s={sidebar_position:34},l="34. [BackEnd] \uc138\uc158\uc744 \uc704\ud55c refresh token",o={unversionedId:"backend-master2/backend34",id:"backend-master2/backend34",title:"34. [BackEnd] \uc138\uc158\uc744 \uc704\ud55c refresh token",description:"\ud604\uc7ac Access \ud1a0\ud070\uc758 \ubb38\uc81c\uc810",source:"@site/docs/backend-master2/backend34.md",sourceDirName:"backend-master2",slug:"/backend-master2/backend34",permalink:"/docs/backend-master2/backend34",draft:!1,tags:[],version:"current",sidebarPosition:34,frontMatter:{sidebar_position:34},sidebar:"backSidebar",previous:{title:"33. [BackEnd] \ubb34\ub8cc \ub3c4\uba54\uc778 Route53 \uc0ac\uc6a9",permalink:"/docs/backend-master2/backend33"},next:{title:"34. [BackEnd] dbdocs \uc0ac\uc6a9",permalink:"/docs/backend-master2/backend35"}},c={},i=[{value:"\ud604\uc7ac Access \ud1a0\ud070\uc758 \ubb38\uc81c\uc810",id:"\ud604\uc7ac-access-\ud1a0\ud070\uc758-\ubb38\uc81c\uc810",level:2},{value:"refresh token \ucd94\uac00 \uc808\ucc28",id:"refresh-token-\ucd94\uac00-\uc808\ucc28",level:2},{value:"\uc124\uc815\uac12 \ucd94\uac00",id:"\uc124\uc815\uac12-\ucd94\uac00",level:3},{value:"sessions \ub370\uc774\ud130\ubca0\uc774\uc2a4 \uc0dd\uc131",id:"sessions-\ub370\uc774\ud130\ubca0\uc774\uc2a4-\uc0dd\uc131",level:3},{value:"sessions \ud14c\uc774\ube14 sql \uc791\uc131",id:"sessions-\ud14c\uc774\ube14-sql-\uc791\uc131",level:3},{value:"mock store \uc5c5\ub370\uc774\ud2b8",id:"mock-store-\uc5c5\ub370\uc774\ud2b8",level:3},{value:"\ub85c\uadf8\uc778 \uc2dc \uc801\uc6a9\ud558\uae30",id:"\ub85c\uadf8\uc778-\uc2dc-\uc801\uc6a9\ud558\uae30",level:2},{value:"refresh_toekn\uc744 \uc0ac\uc6a9\ud574\uc11c access_token \uc7ac\ubc1c\uae09",id:"refresh_toekn\uc744-\uc0ac\uc6a9\ud574\uc11c-access_token-\uc7ac\ubc1c\uae09",level:2}],u={toc:i},p="wrapper";function k(e){let{components:n,...t}=e;return(0,a.kt)(p,(0,r.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"34-backend-\uc138\uc158\uc744-\uc704\ud55c-refresh-token"},"34. ","[BackEnd]"," \uc138\uc158\uc744 \uc704\ud55c refresh token"),(0,a.kt)("h2",{id:"\ud604\uc7ac-access-\ud1a0\ud070\uc758-\ubb38\uc81c\uc810"},"\ud604\uc7ac Access \ud1a0\ud070\uc758 \ubb38\uc81c\uc810"),(0,a.kt)("hr",null),(0,a.kt)("p",null,"Access \ud1a0\ud070\uc774 \ub9cc\ub8cc\uc2dc\uac04\uc774 \uc788\ub294 \uc774\uc720\ub294 \ud0c8\ucde8\ub2f9\ud588\uc744 \ub54c\ub97c \ub300\ube44\ud55c \uadf8\ub098\ub9c8\uc758 \ubcf4\uc548 \ub300\ucc45\uc785\ub2c8\ub2e4. \uadf8\ub807\uae30 \ub54c\ubb38\uc5d0 \uc138\uc158\uc744 \uc624\ub7ab\ub3d9\uc548 \uc720\uc9c0\ud560 \uc218 \uc5c6\ub294 \ubb38\uc81c\uc810\uc774 \uc788\uc2b5\ub2c8\ub2e4. ( \ud1a0\ud070\uc774 \ub9cc\ub8cc\ub418\uba74 \ub2e4\uc2dc \ub85c\uadf8\uc778\ud574\uc57c \ud558\uae30 \ub54c\ubb38 )"),(0,a.kt)("h2",{id:"refresh-token-\ucd94\uac00-\uc808\ucc28"},"refresh token \ucd94\uac00 \uc808\ucc28"),(0,a.kt)("h3",{id:"\uc124\uc815\uac12-\ucd94\uac00"},"\uc124\uc815\uac12 \ucd94\uac00"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"app.env\uc5d0 refresh_token \uc2dc\uac04 \uc124\uc815")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"config.go\uc5d0\uc11c \uc0c8\ub85c\uc6b4 \uac12 \uc5c5\ub370\uc774\ud2b8"))),(0,a.kt)("h3",{id:"sessions-\ub370\uc774\ud130\ubca0\uc774\uc2a4-\uc0dd\uc131"},"sessions \ub370\uc774\ud130\ubca0\uc774\uc2a4 \uc0dd\uc131"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"db \ub9c8\uc774\uadf8\ub808\uc774\uc158")),(0,a.kt)("p",null,"\uc6b0\uc120 \ud30c\uc77c \ub9cc\ub4e4\uace0"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"migrate create -ext sql -dir db/migration -seq <\ub9c8\uc774\uadf8\ub808\uc774\uc158_\uc774\ub984>\n")),(0,a.kt)("p",null,"\uc791\uc131\ud574\uc57c\ud55c\ub2e4."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql",metastring:"title='up\ud30c\uc77c'",title:"'up\ud30c\uc77c'"},'CREATE TABLE "sessions" (\n    "id" uuid PRIMARY KEY,\n  "username" varchar NOT NULL,\n  "refresh_token" varchar NOT NULL,\n  "user_agent" varchar NOT NULL,\n  "client_ip" varchar NOT NULL,\n  "is_blocked" boolean NOT NULL,\n    "expires_at" timestamptz NOT NULL,\n  "created_at" timestamptz NOT   NULL DEFAULT (now())\n);\n\nALTER TABLE "sessions" ADD FOREIGN KEY ("username") REFERENCES "users" ("username");\n')),(0,a.kt)("p",null,"\uc138\uc158 \ud14c\uc774\ube14\uc744 \ub9cc\ub4ed\ub2c8\ub2e4."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql",metastring:"title='down\ud30c\uc77c'",title:"'down\ud30c\uc77c'"},'DROP TABLE IF EXISTS "sessions";\n')),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"migrateup")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"make migrateup\n")),(0,a.kt)("p",null,"\ud55c\ub2e4."),(0,a.kt)("h3",{id:"sessions-\ud14c\uc774\ube14-sql-\uc791\uc131"},"sessions \ud14c\uc774\ube14 sql \uc791\uc131"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql"},"-- name: CreateSession :one\nINSERT INTO sessions(\n    id,\n    username,\n    refresh_token,\n    user_agent,\n    client_ip,\n    is_blocked,\n    expires_at\n) VALUES (\n    $1, $2, $3, $4, $5, $6, $7\n) RETURNING *;\n\n-- name: GetSession :one\nSELECT * FROM sessions\nWHERE id = $1 LIMIT 1;\n")),(0,a.kt)("p",null,"\uc791\uc131 \ud6c4"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"make sqlc\n")),(0,a.kt)("p",null,"\ud558\uba74\ub41c\ub2e4."),(0,a.kt)("h3",{id:"mock-store-\uc5c5\ub370\uc774\ud2b8"},"mock store \uc5c5\ub370\uc774\ud2b8"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"make mock\n")),(0,a.kt)("p",null,"\uc774\uc81c refresh token\uc744 \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \uae30\ubc18\uc740 \ub9c8\ub828\ub410\uc2b5\ub2c8\ub2e4."),(0,a.kt)("h2",{id:"\ub85c\uadf8\uc778-\uc2dc-\uc801\uc6a9\ud558\uae30"},"\ub85c\uadf8\uc778 \uc2dc \uc801\uc6a9\ud558\uae30"),(0,a.kt)("hr",null),(0,a.kt)("p",null,"\ub85c\uadf8\uc778 \ud568\uc218\uc5d0\uc11c access token \uc0dd\uc131\ud560 \ub54c refresh token\uc744 \uc751\ub2f5\uc5d0 \ucd94\uac00\ud574\uc90d\ub2c8\ub2e4."),(0,a.kt)("p",null,"LoginRequest\uc5d0 \ucd94\uac00\ud569\ub2c8\ub2e4."),(0,a.kt)("h2",{id:"refresh_toekn\uc744-\uc0ac\uc6a9\ud574\uc11c-access_token-\uc7ac\ubc1c\uae09"},"refresh_toekn\uc744 \uc0ac\uc6a9\ud574\uc11c access_token \uc7ac\ubc1c\uae09"),(0,a.kt)("hr",null),(0,a.kt)("p",null,"refresh token\uc744 \uc0ac\uc6a9\ud558\uc5ec \ub9cc\ub8cc\ub41c access token\uc744 \uc7ac\ubc1c\uae09\ud574\uc57c \ud569\ub2c8\ub2e4."))}k.isMDXComponent=!0}}]);